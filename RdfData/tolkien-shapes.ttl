@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix kg-ont: <http://tolkien-kg.org/ontology/> .
@prefix schema: <http://schema.org/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

kg-ont:CharacterShape a sh:NodeShape ;
    sh:targetClass kg-ont:Character ;
    
    # Nom obligatoire
    sh:property [
        sh:path schema:name ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:datatype xsd:string ;
        sh:message "Chaque personnage doit avoir exactement un nom (schema:name)." ;
    ] ;
    
    # Genre avec valeurs contrôlées
    sh:property [
        sh:path schema:gender ;
        sh:datatype xsd:string ;
        sh:message "Le genre doit être une chaîne de caractères." ;
    ] ;
    
    # Dates (optionnelles)
    sh:property [
        sh:path kg-ont:birthDate ;
        sh:datatype xsd:string ;
        sh:message "La date de naissance doit être une chaîne." ;
    ] ;
    
    sh:property [
        sh:path kg-ont:deathDate ;
        sh:datatype xsd:string ;
        sh:message "La date de décès doit être une chaîne." ;
    ] ;
    
    # Relation avec une Maison (famille)
    sh:property [
        sh:path kg-ont:family ;
        sh:or (
            [ sh:node kg-ont:HouseShape ]
            [ sh:datatype xsd:string ]
        ) ;
        sh:message "La famille doit être un IRI House ou une string." ;
    ] ;
    
    # Relations parentales (peuvent avoir plusieurs valeurs)
    sh:property [
        sh:path kg-ont:parentage ;
        sh:or (
            [ sh:nodeKind sh:IRI ]
            [ sh:datatype xsd:string ]
        ) ;
        sh:message "Les parents doivent être des IRIs ou des strings." ;
    ] ;
    
    sh:property [
        sh:path kg-ont:children ;
        sh:or (
            [ sh:nodeKind sh:IRI ]
            [ sh:datatype xsd:string ]
        ) ;
        sh:message "Les enfants doivent être des IRIs ou des strings." ;
    ] ;
    
    sh:property [
        sh:path kg-ont:spouse ;
        sh:or (
            [ sh:nodeKind sh:IRI ]
            [ sh:datatype xsd:string ]
        ) ;
        sh:message "L'epoux/epouse doit être un IRI ou une string." ;
    ] ;
    
    # Affiliation (peut être multiple)
    sh:property [
        sh:path kg-ont:affiliation ;
        sh:message "L'affiliation doit être vers une organisation ou un groupe." ;
    ] ;
    
    # Lieux (peuvent être des IRIs OU des strings)
    sh:property [
        sh:path kg-ont:birthLocation ;
        sh:or (
            [ sh:nodeKind sh:IRI ]
            [ sh:datatype xsd:string ]
        ) ;
        sh:message "Le lieu de naissance doit être soit un IRI, soit une string." ;
    ] ;
    
    sh:property [
        sh:path kg-ont:deathLocation ;
        sh:or (
            [ sh:nodeKind sh:IRI ]
            [ sh:datatype xsd:string ]
        ) ;
        sh:message "Le lieu de decès doit être soit un IRI, soit une string." ;
    ] ;
    
    # Propriétés physiques
    sh:property [
        sh:path kg-ont:height ;
        sh:datatype xsd:string ;
        sh:message "La taille doit être une chaîne de caractères." ;
    ] ;
    
    sh:property [
        sh:path kg-ont:hairColor ;
        sh:datatype xsd:string ;
        sh:message "La couleur des cheveux doit être une chaîne." ;
    ] ;
    
    sh:property [
        sh:path kg-ont:eyeColor ;
        sh:datatype xsd:string ;
        sh:message "La couleur des yeux doit être une chaîne." ;
    ] ;
    
    # Armes et montures
    sh:property [
        sh:path kg-ont:weapons ;
        sh:datatype xsd:string ;
        sh:message "Les armes doivent être décrites par une chaîne." ;
    ] ;
    
    sh:property [
        sh:path kg-ont:steed ;
        sh:datatype xsd:string ;
        sh:message "La monture doit être décrite par une chaîne." ;
    ] .

# Forme pour les Maisons
kg-ont:HouseShape a sh:NodeShape ;
    sh:targetClass kg-ont:House .

# Forme pour les Lieux
kg-ont:LocationShape a sh:NodeShape ;
    sh:targetClass kg-ont:Location .